generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int       @id @default(autoincrement())
  name              String
  email             String    @unique
  password          String
  role              Role      @default(EMPLOYEE) // Either ADMIN or EMPLOYEE
  isAdmin           Boolean   @default(false)    // Indicates admin privileges for employees
  companyId         Int?      // Relation to Company
  company           Company?  @relation("CompanyEmployees", fields: [companyId], references: [id])
  managerId         Int?      // Relation to Manager (Self-Reference)
  manager           User?     @relation("ManagerEmployee", fields: [managerId], references: [id])
  subordinates      User[]    @relation("ManagerEmployee") // Relation for subordinates
  departmentId      Int?      // Relation to Department
  department        Department? @relation(fields: [departmentId], references: [id])
  designationId     Int?      // Relation to Designation
  designation       Designation? @relation(fields: [designationId], references: [id])
  headOfDepartment  Department[] @relation("DepartmentHead") // Relation for head of department
  feedbackGiven     Feedback[] @relation("FeedbackGiven")    // Feedback sent by this user
  feedbackReceived  Feedback[] @relation("FeedbackReceived") // Feedback received by this user
  meetingsScheduled Meeting[] @relation("ScheduledMeetings") // Meetings created by this user
  meetingsAttended  Meeting[] @relation("MeetingAttendees")  // Meetings attended by this user
  adminCompanies    Company[] @relation("CompanyAdmin")      // Companies administered by this user
  assignedOKRs      OKR[]     @relation("UserOKRs")          // OKRs assigned to this user
  RequestedFeedback FeedbackRequest[] @relation("RequestedFeedback") // Feedback requests sent by this user
  FeedbackRequest   FeedbackRequest[] @relation("FeedbackRequests")   // Feedback requests for this user
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model Department {
  id                Int       @id @default(autoincrement())
  name              String
  companyId         Int?
  company           Company?  @relation(fields: [companyId], references: [id])
  headId            Int?
  head              User?     @relation("DepartmentHead", fields: [headId], references: [id])
  employees         User[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}


model Company {
  id                 Int              @id @default(autoincrement())
  name               String
  address            String?
  description        String?
  adminId            Int?
  admin              User?            @relation("CompanyAdmin", fields: [adminId], references: [id])
  employees          User[]           @relation("CompanyEmployees")
  departments        Department[]
  okrs               OKR[]            @relation("CompanyOKRs")
  companySetting     CompanySetting?  @relation("CompanyToSetting") // One-to-one relation
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
}

model Designation {
  id          Int       @id @default(autoincrement())
  title       String    @unique // Designation name (e.g., CEO, Developer, etc.)
  description String?   // Optional description for the designation
  users       User[]    // Users with this designation
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}


model OKR {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  companyId   Int?
  company     Company?  @relation("CompanyOKRs", fields: [companyId], references: [id]) // Bidirectional relation
  userId      Int?
  keyResults  KeyResult[] // Relation for Key Results
  assignedTo  User?     @relation("UserOKRs", fields: [userId], references: [id]) // Bidirectional relation
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model KeyResult {
  id          Int      @id @default(autoincrement())
  title       String   // Description of the Key Result
  okrId       Int      // Foreign key linking this Key Result to an OKR
  okr         OKR      @relation(fields: [okrId], references: [id])
  progress    Float    @default(0) // Progress percentage (0-100)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model Feedback {
  id          Int       @id @default(autoincrement())
  feedbackText String
  isAnonymous Boolean    @default(false)
  visibility  Visibility @default(PUBLIC)
  senderId    Int
  receiverId  Int
  sender      User       @relation("FeedbackGiven", fields: [senderId], references: [id])
  receiver    User       @relation("FeedbackReceived", fields: [receiverId], references: [id])
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model FeedbackRequest {
  id          Int          @id @default(autoincrement())
  requesterId Int           // The user sending the feedback request
  requester   User          @relation("RequestedFeedback", fields: [requesterId], references: [id])
  recipientId Int           // The user receiving the feedback request
  recipient   User          @relation("FeedbackRequests", fields: [recipientId], references: [id])
  message     String?       // Optional message or specific questions
  status      RequestStatus @default(PENDING) // Status of the feedback request
  response    String?       // Optional response or reason for rejection
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}


model Meeting {
  id            Int       @id @default(autoincrement())
  title         String
  description   String?
  scheduledById Int
  scheduledBy   User      @relation("ScheduledMeetings", fields: [scheduledById], references: [id])
  attendees     User[]    @relation("MeetingAttendees") // Relation for attendees
  scheduledAt   DateTime  // Stores the date and time of the meeting
  agenda        String?
  notes         String?
  noteToSelf    String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model CompanySetting {
  id                  Int        @id @default(autoincrement())
  companyId           Int        @unique // Ensure this field is unique for one-to-one relation
  company             Company    @relation("CompanyToSetting", fields: [companyId], references: [id]) // Match the relation name
  allowAnonymousFeedback Boolean @default(true)
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
}


enum Role {
  ADMIN
  EMPLOYEE
}


enum Visibility {
  PUBLIC
  PRIVATE
}

enum RequestStatus {
  PENDING      // Request is awaiting a response
  COMPLETED    // Request has been accepted, and feedback has been provided
  REJECTED     // Request was declined by the recipient
  EXPIRED      // Request expired without a response
}